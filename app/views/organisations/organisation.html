{% extends "_templates/_page.html" %}

{% set pageHeading %}
  Organisation – {{ provider.name }}
{% endset %}

{% set navActive = "provider" %}

{% set backText = "Home" %}
{% set backLink = '/home' %}

{% block content %}

    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds-from-desktop">
        <h1 class="govuk-heading-l">{{provider.name}}</h1>

        {% set shouldShowOrganisationSwitchLink = (data.settings.userProviders | length > 1) and not data.isAdmin and not data.isImpersonating | falsify  %}

        {# {% if shouldShowOrganisationSwitchLink %}
          <p class="govuk-body"><a href="/select-organisation" class="govuk-link">Change organisation</a></p>
        {% endif %} #}

        <h2 class="govuk-heading-m">About your organisation</h2>

        {{ govukSummaryList({
          rows: [
            {
              key: {
                text: "Organisation type"
              },
              value: {
                text: activeProvider | getProviderTypeString | sentenceCase
              },
              actions: {
                items: [
                  {
                    href: "#",
                    text: "Change",
                    visuallyHiddenText: "name"
                  }
                ]
              } if false
            },
            {
              key: {
                text: "Team inbox"
              },
              value: {
                text: "teacher-training@" + provider.name | makeFakeSchoolDomain
              },
              actions: {
                items: [
                  {
                    href: "#",
                    text: "Change",
                    visuallyHiddenText: "team inbox"
                  }
                ]
              }
            }
          ]
        }) }}

 
        <h2 class="govuk-heading-m">Team members</h2>

        {{ govukButton({
          "text": "Add a team member"
        }) }}

        {% set providerUsers = data.users.byProvider[provider.name] | sort(attribute = "fullName") %}

        {% if providerUsers | length  > 1 %}
          <ol class="govuk-list">
        {% endif %}

          {% for user in providerUsers %}
            {% if providerUsers | length  > 1 %}
              <li class="govuk-!-margin-bottom-6">
            {% endif %}
            {% set isCurrentUser = user.fullName == data.defaultUser.fullName %}
            <div class="app-user-card">


              <h3 class="govuk-heading-s">
                {{user.fullName}}{% if isCurrentUser %} (you){% endif %}
                <span class="govuk-!-font-weight-regular">
                   – {{user.email}}
                </span>
              </h3>

              {# Permissions #}
              {# {% set userPermissions = (user.providers | getRecordById(provider.id)).access %}
              {{userPermissions | log}}
              <p class="govuk-!-margin-top-1 govuk-!-margin-bottom-0 govuk-!-font-size-16 govuk-hint">Role: {{userPermissions.role}}</p>
              <p class="govuk-!-margin-top-1 govuk-!-margin-bottom-0 govuk-!-font-size-16 govuk-hint">{{ "You have" if isCurrentUser else "This user has" }} permission to:</p>
              <ul class="govuk-list govuk-list--bullet govuk-!-margin-top-1 govuk-!-margin-bottom-0 govuk-!-font-size-16 govuk-hint">

                {% set permissions = userPermissions.permissions | sortPermissions %}
                
                {% for permission in permissions %}
                  <li>{{permission}}</li>
                {% endfor %}
              </ul> #}

            </div>
            {% if providerUsers | length  > 1 %}
              </li>
            {% endif %}
            
          {% endfor %}

        {% if providerUsers | length  > 1 %}
          </ol>
        {% endif %}


      </div>
    </div>

{% endblock %}
