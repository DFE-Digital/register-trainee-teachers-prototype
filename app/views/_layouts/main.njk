{% extends "govuk-prototype-kit/layouts/govuk-branded.njk" %}

{# custom components #}
{% from "_components/admin-banner/macro.njk" import appAdminBanner %}
{% from "_components/admin-feature/macro.njk" import appAdminFeature %}
{% from "_components/autocomplete-new/macro.njk" import appAutocompleteFromInput %}
{% from "_components/autocomplete-new/macro.njk" import appAutocompleteFromSelect %}
{% from "_components/autocomplete/macro.njk" import appAutocomplete %}
{% from "_components/banner/macro.njk" import appBanner %}
{% from "_components/download-link-with-filename/macro.njk" import appDownloadLink %}
{% from "_components/filter-page/macro.njk" import appFilterPage %}
{% from "_components/footer/macro.njk" import appFooter %}
{% from "_components/school-autocomplete/macro.njk" import appSchoolAutocomplete with context %}
{% from "_components/sub-navigation/macro.njk" import appSubNavigation %}
{% from "_components/timeline/macro.njk" import appTimeline %}

{% block head %}
  {% include "_includes/head.njk" %}
{% endblock %}

{% block pageTitle %}
  {{ pageTitle }}
{% endblock %}

{% block header %}

    {# Show banner to get out of impersonation mode #}
    {% if data.isImpersonating | falsify %}
      {% include "_includes/impersonate-provider-banner.njk" %}
    {% endif %}

  {% include "_includes/cookie-banner.njk" %}

  {% set shouldShowOrganisationSwitchLink = (data.settings.userProviders | length > 1) and not data.isAdmin and not data.isImpersonating | falsify and not hidePrimaryNav and not isSupportUi %}

  {# Set serviceName in config.js. #}
  {% set headerClass = 'app-light-header' %}
  {{ govukHeader({
    homepageUrl: "/start-page",
    productName: serviceName if not isSupportUi else "Support for Register",
    serviceUrl: "/records",
    classes: headerClass,
    containerClasses: "govuk-width-container",
    navigation: [
      {
        href: "#1",
        text: "Your account"
      } if false,
      {
        href: "/select-organisation",
        text: "Change organisation"
      } if shouldShowOrganisationSwitchLink and false,
      {
        href: "/start-page",
        text: "Sign out"
      }
    ] if not hideNav
  }) }}

  {% if shouldShowOrganisationSwitchLink %}
    {% include "_includes/organisation-switcher.njk" %}
  {% endif %}

  {% set rightHandSideNavHtml %}

    {% if not data.isAdmin and not data.isImpersonating | falsify and not isSupportUi %}
      {% set providerName = data.settings.userActiveProvider %}

      <nav class="moj-primary-navigation">
        <ul class="moj-primary-navigation__list">
          {% set ariaCurrent = "aria-current=page" if navActive == "provider" %}
          <li class="moj-primary-navigation__item">
            <a class="moj-primary-navigation__link" {{ ariaCurrent }} href="/organisations/{{activeProvider.id}}">
              Organisation details
            </a>
          </li>

        </ul>

      </nav>
    {% endif %}

  {% endset %}

  {% set navItemsUser = [
    {
      text: 'Home',
      href: '/home',
      active: true if navActive == 'home'
    },
    {
      text: 'Draft trainees',
      href: '/drafts',
      active: true if navActive == 'drafts'
    } if isAuthorised('viewDrafts'),
    {
      text: 'Registered trainees',
      href: '/records',
      active: true if navActive == 'records'
    },
    {
      text: 'Bulk updates',
      href: '/bulk-update',
      active: true if navActive == 'bulk'
    } if isAuthorised('bulkActions') and data.settings.bulkLinksInPrimaryNav == "Show bulk recommend",
    {
      text: 'Bulk updates',
      href: '/bulk-update',
      active: true if navActive == 'bulk'
    } if isAuthorised('bulkActions') and data.settings.bulkLinksInPrimaryNav == "Show bulk updates",
    {
      text: 'Bulk actions',
      href: '/bulk-action/new',
      active: true if navActive == 'bulk'
    } if isAuthorised('bulkActions') and data.settings.bulkLinksInPrimaryNav == "Show bulk actions",
    {
      text: 'Courses',
      href: '/root/case-list',
      active: true if navActive == 'courses'
    } if false,
    {
      text: 'Reports',
      href: '/reports',
      active: true if navActive == 'reports'
    } if isAuthorised('exportRecords'),
    {
      text: 'Funding',
      href: '/funding/' + data.years.currentAcademicYearSimple + '/payment-schedule',
      active: true if navActive == 'Funding'
    } if data.settings.showFundingInPrimaryNav
  ] | removeEmpty %}

  {% set navItemsSupport = [
    {
      text: 'Home',
      href: '/support',
      active: true if navActive == 'home'
    },
    {
      text: 'Draft trainees',
      href: '/support/trainees',
      active: true if navActive == 'drafts'
    },
    {
      text: 'Registered trainees',
      href: '/support/trainees',
      active: true if navActive == 'trainees'
    },
    {
      text: 'Users',
      href: '/support/users',
      active: true if navActive == 'users'
    },
    {
      text: 'Organisations',
      href: '/support/organisations',
      active: true if navActive == 'organisations'
    },
    {
      text: 'Schools',
      href: '/support/schools',
      active: true if navActive == 'schools'
    },
    {
      text: 'Courses',
      href: '/support/courses',
      active: true if navActive == 'courses'
    } if false,
    {
      text: 'Data',
      href: '/support/data',
      active: true if navActive == 'data'
    },
    {
      text: 'Funding',
      href: '/support/funding',
        active: true if navActive == 'funding'
    },
    {
      text: 'Settings',
      href: '/support/settings',
      active: true if navActive == 'settings'
    }
  ] | removeEmpty %}

  {% if isSupportUi %}
    {% set navItems = navItemsSupport %}
  {% else %}
    {{ currentPageUrl | log}}
    {% set navItems = navItemsUser %}
  {% endif %}

  {% if not hidePrimaryNav %}

    {{ mojPrimaryNavigation({
    label: 'Primary navigation',
    items: navItems,
    containerClasses: "app-primary-navigation--support-ui" if isSupportUi,
    searchHtml: rightHandSideNavHtml
    }) }}

  {% endif %}

{% endblock %}

{% block beforeContent %}

  {{ govukPhaseBanner({
    attributes: {
      "role": "status"
    },
    tag: {
      text: "prototype"
    },
    classes: 'govuk-!-margin-top-1',
    html: 'This is a prototype of a new service â€“ your <a href="#" class="govuk-link">feedback</a> will help us improve it'
  }) }}

  {% block pageNavigation %}
  {% endblock %}

  {% block pageBanner %}
{% endblock %}

{% endblock %}

{% set mainClasses = mainClasses | default("govuk-main-wrapper--auto-spacing") %}

{% set metaHtml %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-one-half">
      <h2 class="govuk-heading-s">
        Get support
      </h2>

      <ul class="govuk-footer__meta-custom govuk-list govuk-!-font-size-16">
        <li><a class="govuk-link govuk-footer__link" href="mailto:becomingateacher@digital.education.gov.uk">becomingateacher<wbr>@digital.education.gov.uk</a></li>
        <li>We aim to respond within 5 working days, or one working day for more urgent&nbsp;queries</li>
      </ul>
    </div>

    <div class="govuk-grid-column-one-half">
      <h2 class="govuk-heading-s">
        Give feedback
      </h2>

      <p class="govuk-body govuk-!-font-size-16"><a href="/guidance" class="govuk-link govuk-footer__link">Give feedback to help us improve <span class="app-nowrap">Register trainee teachers</span></a></p>

    </div>
  </div>
{% endset %}

{% if useAutoStoreData %}
  {% block footer %}
    {{ appFooter({
      classes: "govuk-footer--app",
      meta: {
        _title: "Get support",
        html: metaHtml,
        items: [
          {
            href: "/guidance",
            text: "How to use this service"
          },{
            href: "/accessibility-statement",
            text: "Accessibility"
          },{
            href: "/cookies",
            text: "Cookies"
          },{
            href: "/privacy-notice",
            text: "Privacy"
          }
        ]
      }
    }) }}
    {% include "_includes/footer-settings.njk" %}
  {% endblock %}
{% endif %}


{% block bodyEnd %}
  {% block scripts %}
    {% include "_includes/scripts.njk" %}
    {% block pageScripts %}{% endblock %}
  {% endblock %}
  <!-- GOV.UK Prototype Kit {{releaseVersion}} -->
{% endblock %}
