{% include "_includes/trainee-name-caption.njk" %}
<h1 class="govuk-heading-l">
  {{pageHeading}}
</h1>

{% set placementCount = record.placement.items | length %}

{# Placement data is stored in a temp location before being merged back to array #}

{# Get placement (if it exists) from existing data #}
{% set placement = {} %}

{% if record.placement.items %}
  {% set placement = record.placement.items | getRecordById(placementUuid) %}
{% endif %}

{# Merge with temp store #}
{% set placementTemp = placement | mergeObjects(data.placementTemp) %}

{% set label = "Search for a school by its unique reference number (URN), name or postcode" %}

{# Todo - this could probably be the default that the autocomplete progressively enhances #}
<div class="app-no-js-only">
  {{ govukInput({
    id: "schoolSearch",
    name: "_schoolSearch",
    label: {
      text: label
    },
    value: query._schoolSearch,
    classes: 'app-!-max-width-two-thirds'
  }) }}
</div>

<div class="app-js-only">
  {{ appSchoolAutocomplete({
    name: "placementTemp[school][uuid]",
    value: (placementTemp.school.schoolName | safe),
    uuid: placementTemp.school.uuid,
    label: {
      text: label
    }
  }) }}
</div>

{% set detailsHtml %}

  <p class="govuk-body">
    If the lead school is missing from the list, contact <a class="govuk-link" href="mailto:becomingateacher@digital.education.gov.uk">becomingateacher@digital.education.gov.uk</a>
  </p>

  <p class="govuk-body">You do not need to provide a lead school if the trainee is funded or employed privately.</p>

  {{ govukCheckboxes({
    items: [
      {
        value: "true",
        text: "Lead school is not applicable"
      }
    ]
    } | decorateAttributes(placementTemp, "placementTemp.notApplicable")) }}
{% endset %}

{# {{ govukDetails({
  summaryText: "Lead school is not listed, or the trainee is funded or employed privately",
  html: detailsHtml,
  open: true if record.schools.leadSchool.notApplicable == "true"
}) }} #}

{# Commented out for now as not sure about this #}
{# Only show the checkbox where we're using the autocomplete and we've not already got results #}
{# <div class="app-js-only">
  Show a checkbox only if employing school isn’t already set and we’re on a route that has employing school
  {% if record | requiresField("employingSchool") and not record.schools.employingSchool %}
    No fieldset as this is a single checkbox item
    {{ govukCheckboxes({
      items: [
        {
          value: "true",
          text: "This school is also the employing school"
        }
      ]
    } | decorateAttributes(record, "record.schools.leadSchoolIsEmployingSchool")) }}
  {% endif %}
</div> #}


{{ govukButton({
  text: "Continue"
}) }}
