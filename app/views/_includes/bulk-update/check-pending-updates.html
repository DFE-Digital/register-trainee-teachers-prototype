{# {% if data.bulk.recommendFixErrors or data.bulk.addDetailsFixErrors %}
  {% include "_includes/bulk-update/upload-summary-panel.html" %}
{% endif %} #}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds-from-desktop">
    <h1 class="govuk-heading-l">
      <span class="govuk-caption-l">{{ data.signedInProviders | andSeparate }}</span>
      {{ pageHeading }}
    </h1>
  </div>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">

    {{ govukTable({
      caption: tableCaption,
      captionClasses: tableCaptionClasses,
      head: tableHeadRow,
      rows: tableBodyRows
    }) if bulkPath == "add-details" }}

    {% if bulkPath == "recommend" %}

    {% set totalCount = qtsTableBodyRows | length %}

    {% set chunkSize = 50 %}

    

    {% if totalCount > chunkSize %}
      {% set chunkedRows = qtsTableBodyRows | batch(chunkSize) %}

      {% set accordionItems = [] %}

      {% for chunk in chunkedRows %}
        {% set tableHtml %}
          {{ govukTable({
            head: tableHeadRow,
            rows: chunk
          }) }}
        {% endset %}

        {% set chunkStart = (loop.index0 * chunkSize) + 1 %}
        {% set chunkEnd = (loop.index0 * chunkSize) + chunkSize %}
        {% if chunkEnd > totalCount %}
          {% set chunkEnd = totalCount %}
        {% endif %}

        {% set accordionHeadingText %}
          Trainees being recommended for QTS ({{ chunkStart }} to {{ chunkEnd }})
        {% endset %}
        {% set accordionItems = accordionItems | push({
          heading: {
            text: accordionHeadingText
          },
          content: {
            html: tableHtml
          },
          expanded: true if loop.first else false
        }) %}

      {% endfor %}

      {# <h2 class="govuk-heading-m">{{qtsTableCaption}}</h2> #}

      {# NowUTC used to give the id a new unique name, so the same item is *always* open #}
      {{ govukAccordion({
        id: "qts-accordion-" + nowUTC(),
        items: accordionItems,
        headingLevel: 3
      }) }}

    {% else %}

      {{ govukTable({
        caption: qtsTableCaption,
        captionClasses: tableCaptionClasses,
        head: tableHeadRow,
        rows: qtsTableBodyRows
      }) if totalCount > 0 }}

    {% endif %}

    


      {# {{ govukTable({
        caption: qtsTableCaption,
        captionClasses: tableCaptionClasses,
        head: tableHeadRow,
        rows: qtsTableBodyRows
      }) if qtsTableBodyRows.length > 0 }}

      {{ govukTable({
        caption: eytsTableCaption,
        captionClasses: tableCaptionClasses,
        head: tableHeadRow,
        rows: eytsTableBodyRows
      }) if eytsTableBodyRows.length > 0 }} #}
    {% endif %}
  </div>
</div>
<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <div class="js-stick-at-bottom-when-scrolling">
      <p class="govuk-body govuk-!-margin-bottom-5">
        <a href="upload-changes">Make changes to your pending updates</a>
      </p>
      <form action="/bulk-update/{{ bulkPath }}/confirmation" method="post" novalidate>
        <div class="govuk-button-group govuk-!-margin-bottom-0">
              {{ govukButton({
                text: buttonText
              }) }}
          <a href="/bulk-update/cancel-bulk-updates" class="govuk-link">Cancel bulk {{ "recommending trainees" if data.settings.bulkLinksInPrimaryNav == "Show bulk recommend" else "updates to records" }}</a>
        </div>
      </form>
    </div>
  </div>
</div>
