{% extends "_templates/_page.njk" %}

{% set pageHeading = "Bulk add placement details to trainee records" %}
{% set navActive = 'bulk' %}

{% set filteredRecords = data.records | filterRecords(data) %}

{% set traineesThatCanBeUpdated = filteredRecords | filterByCanBulkUpdate %}
{% set traineesWithoutStartDates = traineesThatCanBeUpdated | filterByNeedsStartDate | length %}
{% set traineesWithoutPlacements = traineesThatCanBeUpdated | filterByNeedsPlacements | length %}

{% set placementRowHeading = [] %}
{% for i in range(0, data.settings.minPlacementsRequired) %}
{% set placementRowHeading = placementRowHeading | push('<span class="app-nowrap">‘Placement ' + loop.index + ' URN’</span>') %}
{% endfor %}


{% block content %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds-from-desktop">
    <div class="govuk-error-summary" data-module="govuk-error-summary">
      <div role="alert">
        <h2 class="govuk-error-summary__title">
          There is a problem
        </h2>
        <div class="govuk-error-summary__body">
          <ul class="govuk-list govuk-error-summary__list">
            <li>
              The CSV template structure has been changed
            </li>
          </ul>
          <details class="govuk-details">
            <summary class="govuk-details__summary">
              <span class="govuk-details__summary-text">
                View the items that must be included
              </span>
            </summary>
            <div class="govuk-details__text">
              <ul class="govuk-list">
                <li>Provider Trainee ID</li>
                <li>Application ID</li>
                <li>HESA ID</li>
                <li>First Names</li>
                <li>Last Name</li>
                <li>Previous Last Name</li>
                <li>Date of Birth</li>
                <li>NI Number</li>
                <li>Sex</li>
                <li>Email</li>
                <li>Nationality</li>
                <li>Ethnicity</li>
                <li>Disability 1</li>
                <li>Disability 2</li>
                <li>Disability 3</li>
                <li>Disability 4</li>
                <li>Disability 5</li>
                <li>Disability 6</li>
                <li>Disability 7</li>
                <li>Disability 8</li>
                <li>Disability 9</li>
                <li>ITT Aim</li>
                <li>Training Route</li>
                <li>Qualification Aim</li>
                <li>Course Subject One</li>
                <li>Course Subject Two</li>
                <li>Course Subject Three</li>
                <li>Study Mode</li>
                <li>ITT Start Date</li>
                <li>ITT End Date</li>
                <li>Course Age Range</li>
                <li>Course Year</li>
                <li>Lead Partner URN</li>
                <li>Employing School URN</li>
                <li>Trainee Start Date</li>
                <li>PG Apprenticeship Start Date</li>
                <li>First Placement URN</li>
                <li>Fund Code</li>
                <li>Funding Method</li>
                <li>Training Initiative</li>
                <li>Additional Training Initiative</li>
                <li>UK Degree Type</li>
                <li>Non-UK Degree Type</li>
                <li>Degree Subject</li>
                <li>Degree Grade</li>
                <li>Degree Graduation Year</li>
                <li>Degree UK Awarding Institution</li>
                <li>Degree Country</li>
              </ul>
            </div>
          </details>
        </div>
      </div>
    </div>

    <h1 class="govuk-heading-l">
      <span class="govuk-caption-l">{{ data.signedInProviders | andSeparate }}</span>
      {{ pageHeading }}
    </h1>
    <p class="govuk-body">
      You’ll be asked to include placement data as part of performance profile sign off for registered trainees with a course outcome in the previous academic year.
    </p>
    <p class="govuk-body">
      You have trainee records that need additional details:
    </p>
    <ul class="govuk-list govuk-list--bullet">
      <li>{{ traineesThatCanBeUpdated | length }} that can be bulk updated</li>
    </ul>
    <h2 class="govuk-heading-m">
      1. Export a template file
    </h2>
    {{ appDownloadLink({
        linkText: "Download trainees with missing details",
        fileName: "bulk-update/add-details",
        showDownloadedFileName: true,
        downloadedFileName: (data.signedInProviders + "-trainees to add missing prepopulated") | slugify,
        fileType: "csv"
      })}}
    <h2 class="govuk-heading-m">
      2. Add missing details
    </h2>
    <p class="govuk-body">
      Open as a CSV file and add the missing information..
    </p>
    <p class="govuk-body">
      You can leave rows or cells empty if you do not want to update those trainee records.
    </p>

    <h3 class="govuk-heading-s">Placement schools</h3>
    <p class="govuk-body">
      In the columns {{ placementRowHeading | joinify | safe }} add the school’s URN.
    </p>
    <p class="govuk-body">
      You can find the URNs using <a href="https://www.get-information-schools.service.gov.uk/Search" target="_blank" class="govuk-link">Get information about schools (opens in a new tab)</a>.
    </p>
    <p class="govuk-body">
      You cannot add information in bulk if the school or setting does not have a URN. Add those placements to the trainee record manually.
    </p>
    <p class="govuk-body">
      If the trainee did more than {{ data.settings.minPlacementsRequired }} placements, add those extra placements to the trainee record manually.
    </p>
    <p class="govuk-body">
      If you do not have the information for a placement, leave the cell empty.
    </p>
    <h2 class="govuk-heading-m">
      3. Upload your trainee records
    </h2>
    <form action="/bulk-update/add-details/bulk-update-answer" method="post" novalidate>
      {{ govukFileUpload({
          id: "file-upload-1",
          name: "file-upload-1",
          hint: {
            text: "File type must be ‘CSV’."
          },
          label: {
            text: "Upload a file"
          },
          attributes: {
            "accept": ".csv"
          }
        }) }}
      {{ govukButton({
          text: "Upload records"
        }) }}
    </form>
  </div>
</div>

{% endblock %}
