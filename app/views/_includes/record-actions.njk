{# Button menu #}

{% set reinstateUrl %}
  {% if (record | ittInTheFuture) %}
    {{ referrer + "/reinstate/confirm" }}
  {% else %}
    {{ referrer + "/reinstate" }}
  {% endif %}
{% endset %}

{% set withdrawUrl %}
  {% if (record | ittStartedButNoCommencementDate) %}
    {{ referrer + "/withdraw/did-trainee-start" | addReferrer(referrer) }}
  {% else %}
    {{ referrer + "/withdraw" | addReferrer(referrer) }}
  {% endif %}
{% endset %}

{% set deferUrl %}
  {% if (record | ittInTheFuture) %}
    {{ referrer + "/defer/confirm" | addReferrer(referrer) }}
  {% elseif (record | ittStartedButNoCommencementDate) %}
    {{ referrer + "/defer/did-trainee-start" | addReferrer(referrer) }}
  {% else %}
    {{ referrer + "/defer" | addReferrer(referrer) }}
  {% endif %}
{% endset %}

{% set removeUrl %}
  {{ referrer + "/remove/confirm" | addReferrer(referrer) }}
{% endset %}

{% set buttonMenuItems = [] %}

{% if (record | isDeferred ) and record.trainingDetails.commencementDate %}
  {%- set buttonMenuItems = buttonMenuItems | push(
    { text: "Reinstate", href: reinstateUrl, classes: "govuk-button--secondary" }
  ) -%}
  {%- set buttonMenuItems = buttonMenuItems | push(
    { text: "Withdraw", href: withdrawUrl, classes: "govuk-button--secondary" }
  ) -%}
{% elseif (record | isDeferred ) and not record.trainingDetails.commencementDate %}
  {%- set buttonMenuItems = buttonMenuItems | push(
    { text: "Reinstate", href: reinstateUrl, classes: "govuk-button--secondary" }
  ) -%}
  {%- set buttonMenuItems = buttonMenuItems | push(
    { text: "Remove record", href: removeUrl, classes: "govuk-button--secondary" }
  ) -%}
{% elseif (record | ittInTheFuture) %}
  {%- set buttonMenuItems = buttonMenuItems | push(
    { text: "Did not start", href: removeUrl, classes: "govuk-button--secondary" }
  ) -%}
  {%- set buttonMenuItems = buttonMenuItems | push(
    { text: "Defer", href: deferUrl, classes: "govuk-button--secondary" }
  ) -%}
{% elseif (record | ittStartedButNoCommencementDate) %}
  {%- set buttonMenuItems = buttonMenuItems | push(
    { text: "Did not start", href: removeUrl, classes: "govuk-button--secondary" }
  ) -%}
  {%- set buttonMenuItems = buttonMenuItems | push(
    { text: "Defer", href: deferUrl, classes: "govuk-button--secondary" }
  ) -%}
  {%- set buttonMenuItems = buttonMenuItems | push(
    { text: "Withdraw", href: withdrawUrl, classes: "govuk-button--secondary" }
  ) -%}
{% elseif (record | traineeStarted) %}
  {%- set buttonMenuItems = buttonMenuItems | push(
    { text: "Defer", href: deferUrl, classes: "govuk-button--secondary" }
  ) -%}
  {%- set buttonMenuItems = buttonMenuItems | push(
    { text: "Withdraw", href: withdrawUrl, classes: "govuk-button--secondary" }
  ) -%}
{% endif %}


<div class="govuk-grid-row">
  <div class="govuk-grid-column-one-half">
    {% if record.status | canRecommendForQts %}
      {% if record | ittInTheFuture %}
        {{ govukInsetText({
        text: "The traineeâ€™s ITT starts on " + (record.courseDetails.startDate | govukDate),
        classes: "govuk-!-margin-0"
      }) }}
      {% elseif record | hasOutstandingActions %}
        {{ govukInsetText({
          text: "This trainee record requires additional details",
          classes: "govuk-!-margin-0"
        }) }}
      {% else %}
        {{ govukButton({
          text: "Recommend trainee for " + (record | getQualificationText),
          href: referrer + '/qualification/outcome-date',
          classes: "govuk-!-margin-bottom-0"
        }) }}
      {% endif %}
    {% elseif record.status == "Pending TRN" %}
      {{ govukInsetText({
        text: "This trainee is pending a TRN",
        classes: "govuk-!-margin-0"
      }) }}
    {% elseif record.status == "Deferred" %}
      {{ govukInsetText({
        text: "This trainee is deferred",
        classes: "govuk-!-margin-0"
      }) }}
    {% endif %}
  </div>

  <div class="govuk-grid-column-one-half record-actions--secondary">

  {{ mojButtonMenu({
    items: buttonMenuItems
  }) }}

  </div>

</div>


<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <hr class="govuk-section-break govuk-section-break--l govuk-!-margin-top-3 govuk-section-break--visible">
  </div>
</div>

